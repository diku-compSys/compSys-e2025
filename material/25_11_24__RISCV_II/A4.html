<!DOCTYPE html>
<html>
  <head>
    <title>Simulatoropgaven</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);


      @media print {
      .remark-slide-scaler {
              width: 100% !important;
              height: 100% !important;
              transform: scale(1) !important;
              top: 0 !important;
              left: 0 !important;
          }
      }

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">


# A4 - Simulatoropgaven

## Opgave

Der skal implementeres en disassembler og simulator for RISC-V, 32-bit base instruktionssæt og udvidelsen
for 32-bit multiplikation/division. Dog skal enkelte specielle instruktioner ikke indgå.
Derudover skal simulatoren håndtere nogle få systemkald. Detaljer gives nedenfor. 
Simulatoren skal skrives i C.

Derpå skal der laves en undersøgelse af hopforudsigere. Dette kræver en udvidelse af
simulatoren så den kan simulere hopforudsigere. Selve undersøgelsen skal gennemføres
ved at køre nogle udleverede programmer (og inddata) og opsamle antallet af forudsigelser
og fejlforudsigelser.

---
# A4 - Del 1: Simulatoren

Til hjælp udleveres en ufærdig simulator som skal færdiggøres. Den udleverede kode tager
hånd om simulation af lager og indlæsning af et program til dette lager. For at løse opgaven
skal I tilføje filen "simulate.c" og der implementere funktionen "simulate()", som allerede er 
erklæret i "simulate.h". Endvidere skal i tilføje filen "disassemble.c" og der implementere
funktionen "disassemble()" som allerede er erklæret i "disassemble.h"

Der er tidligere udleveret nogle programmer (find dem i "resources/tiny_riscv" i kursets
offentlige repo). De fire af dem ("hello.c", "echo.c", "fib.c" og "erat.c") skal kunne 
afvikles på den færdige simulator. Disse programmer er skrevet i C og du kan bruge krydscompileren 
introduceret i tidligere forelæsning til at oversætte dem til et format
som den færdige simulator kan læse.

Der skal opstilles og gennemføres en afprøvning af både disassemblering og simulering af alle instruktionerne.

---
# A4 - Del 2: Hopforudsigelse

Simulatoren fra delopgave 1 skal udvides så den kan tælle antallet af fejl-forudsigelser for
fire forskellige forudsigere:

 * [NT] Hop forudsiges altid Ikke-taget.
 * [BTFNT] Baglæns hop forudsiges altid taget, forlæns forudsiges altid ikke taget.
 * [Bimodal] Dynamisk forudsigelse. Find selv ud af, hvad bimodal predictor.
 * [gShare] Dynamisk forudsigelse. Find selv ud af, hvad en gShare predictor.

For Bimodal og gShare skal optælles data for 4 forskellige størrelser: 256, 1K, 4K og 16K,
hvor størrelsen angiver antallet af 2-bit tilstandsmaskiner.

Der udleveres nogle programmer (og tilhørende inddata) som skal simuleres for alle de
forskellige forudsigere. Antallet af forudsigelser og antallet af fejlforudsigelser skal rapporteres.


---
# A4 - Simulatoropgaven

Besvarelsen skal indeholde:

* En kort rapport. Her bør I kort beskrive:
  * Jeres overordnede design/tilgang
  * Hvordan I afkoder instruktionerne (herunder genererer den korrekte "immediate" hvis relevant)
  * Hvordan I har afprøvet og hvad jeres afprøvning viser.
  * Hvis der er noget i ikke lykkedes med at implementere, hvorfor tror i så det var?
* Implementationen af disassembly-funktionen
* Implementationen af simulerings-funktionen
* Dokumentation for afprøvningen. For hver instruktion bør i anføre:
  * Hvad i afprøver
  * Hvordan i konkret afprøver det i form af et minimalt assembler program
* Dokumentation for at de nævnte 4 C programmer kan disassembles og afvikles af simulatoren
* Et afsnit om forudsigere som kort forklarer de 4 forudsigere.
* En beskrivelse af hvordan I har implementeret simuleringen af forudsigerne.
* Et afsnit med data og fortolkning af data. Hvad viser data om forudsigere og programmer?

---
# A4 - Hvilke instruktioner

Den autoritative reference (herefter kaldet "riscv spec") for instruktionernes indkodning er her:

~~~
Detaljer: https://github.com/riscv/riscv-isa-manual/releases/download/20240411/unpriv-isa-asciidoc.pdf
~~~

Bemærk især figurene i afsnit 2 i dette dokument.

Simulatoren skal håndtere RISC-V 32 bit base instruktionssæt (I) og udvidelsen
for 32 bit multiplikation (M). Instruktionerne i base instruktionssættet er alle 
nævnt på "det grønne ark" som indgår i COD. Arket nævner også RV64M udvidelsen
(64 bit multiplikation), men det er altså 32-bit udvidelsen som skal 
implementeres. Denne udvidelse ligner meget men er ikke identisk. Find den beskrevet
i riscv spec.

Detaljer om hver instruktion findes i riscv spec.

Dog skal følgende instruktioner fra det grønne ark IKKE implementeres: 

~~~
ebreak, fence, fence.i, CSRRW, CSRRS, CSRRC, CSRRWI, CSRRSI og CSRRCI.
~~~
---
# A4 Systemkald

Systemkald udføres med "ecall" instruktionen. Værdien i A7 angiver hvilket systemkald der
er tale om. Der skal implementeres følgende fire systemkald.

~~~
Kald:           Effekt:
1               returner "getchar()" i A0
2               udfør "putchar(c)", hvor c tages fra A0
3 og 93         afslut simulationen
~~~


---



    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
      /**
        Set the page attribute dynamically, as needed for printing to PDF.
       **/
      (function() {
          var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
          if (!r) return;
          s.type = "text/css";
          s.innerHTML = "@page { size: " + r.style.width + " " + r.style.height +"; }";
          d.head.appendChild(s);
      })();

    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
